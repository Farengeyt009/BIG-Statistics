# Task Manager - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
2. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
3. [Backend API](#backend-api)
4. [Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã](#frontend-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
5. [–í–æ—Ä–∫—Ñ–ª–æ—É —Å–∏—Å—Ç–µ–º–∞](#–≤–æ—Ä–∫—Ñ–ª–æ—É-—Å–∏—Å—Ç–µ–º–∞)
6. [–°–∏—Å—Ç–µ–º–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–π](#—Å–∏—Å—Ç–µ–º–∞-—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–π)
7. [–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞](#–ø—Ä–∞–≤–∞-–¥–æ—Å—Ç—É–ø–∞)

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
- **Backend:** Python 3.x, Flask
- **Database:** Microsoft SQL Server
- **Frontend:** React 18, TypeScript, Vite
- **UI:** Tailwind CSS, dnd-kit
- **State:** React Hooks (–ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
BIG_STATISTICS/
‚îú‚îÄ‚îÄ Back/
‚îÇ   ‚îî‚îÄ‚îÄ TaskManager/
‚îÇ       ‚îú‚îÄ‚îÄ api/           # Flask blueprints
‚îÇ       ‚îú‚îÄ‚îÄ service/       # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ       ‚îî‚îÄ‚îÄ sql/           # SQL —Å–∫—Ä–∏–ø—Ç—ã
‚îî‚îÄ‚îÄ Front/big-statistics-dashboard/
    ‚îî‚îÄ‚îÄ src/pages/TaskManager/
        ‚îú‚îÄ‚îÄ components/    # React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
        ‚îî‚îÄ‚îÄ hooks/         # Custom hooks
```

---

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ö–µ–º–∞: Task_Manager

#### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:

**projects** - –ü—Ä–æ–µ–∫—Ç—ã
```sql
- id (PK)
- name, description
- owner_id (FK ‚Üí Users.users)
- has_workflow_permissions (BOOLEAN)
- default_assignee_id, default_subtask_assignee_id
- created_at, updated_at
```

**project_members** - –£—á–∞—Å—Ç–Ω–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤
```sql
- id (PK)
- project_id (FK ‚Üí projects, CASCADE)
- user_id (FK ‚Üí Users.users)
- role (owner|admin|member|viewer)
- added_by, added_at
```

**tasks** - –ó–∞–¥–∞—á–∏
```sql
- id (PK)
- project_id (FK ‚Üí projects, CASCADE)
- parent_task_id (FK ‚Üí tasks, NO ACTION)
- title, description
- status_id (FK ‚Üí workflow_statuses)
- assignee_id, creator_id
- priority (low|medium|high|critical)
- due_date, completed_at
- order_index
- created_at, updated_at
```

**workflow_statuses** - –°—Ç–∞—Ç—É—Å—ã –≤–æ—Ä–∫—Ñ–ª–æ—É
```sql
- id (PK)
- project_id (FK ‚Üí projects, CASCADE)
- name, color
- is_initial, is_final, is_system
- order_index
```

**workflow_transitions** - –ü–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å—Ç–∞—Ç—É—Å–∞–º–∏
```sql
- id (PK)
- project_id (FK ‚Üí projects, CASCADE)
- from_status_id, to_status_id
- name
- permission_type (any|roles|users)
- allowed_roles (JSON), allowed_users (JSON)
- is_bidirectional
- requires_attachment, requires_approvals
- required_approvals_count, required_approvers (JSON)
- auto_transition
```

**task_approvals** - –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è
```sql
- id (PK)
- task_id (FK ‚Üí tasks, CASCADE)
- user_id (FK ‚Üí Users.users)
- approved_at, comment
- UNIQUE(task_id, user_id)
```

**custom_fields** - –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è
```sql
- id (PK)
- project_id (FK ‚Üí projects, CASCADE)
- field_name, field_type (text|number|date|select|checkbox)
- field_options (JSON –¥–ª—è select)
- is_required, is_active
- order_index
```

**custom_field_values** - –ó–Ω–∞—á–µ–Ω–∏—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø–æ–ª–µ–π
```sql
- id (PK)
- task_id (FK ‚Üí tasks, CASCADE)
- field_id (FK ‚Üí custom_fields, NO ACTION - —è–≤–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –≤ –∫–æ–¥–µ)
- value
```

**task_comments, task_attachments, tags, task_tags** - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, —Ñ–∞–π–ª—ã, —Ç–µ–≥–∏

---

## Backend API

### Endpoints —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

**Projects API** (`/api/task-manager/projects`)
- `GET /` - –°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /:id` - –î–µ—Ç–∞–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞
- `POST /` - –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
- `PUT /:id` - –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
- `DELETE /:id` - –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
- `POST /:id/transfer-ownership` - –ü–µ—Ä–µ–¥–∞—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞
- `GET /:id/members` - –£—á–∞—Å—Ç–Ω–∏–∫–∏
- `POST /:id/members` - –î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞
- `DELETE /:id/members/:user_id` - –£–¥–∞–ª–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞

**Tasks API** (`/api/task-manager/tasks`)
- `GET /project/:id` - –ó–∞–¥–∞—á–∏ –ø—Ä–æ–µ–∫—Ç–∞ (+ `?parent_task_id=X` –¥–ª—è –ø–æ–¥–∑–∞–¥–∞—á)
- `GET /:id` - –î–µ—Ç–∞–ª–∏ –∑–∞–¥–∞—á–∏
- `POST /` - –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç ID)
- `PUT /:id` - –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞—á—É
- `DELETE /:id` - –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É (+ –ø–æ–¥–∑–∞–¥–∞—á–∏)

**Workflow API** (`/api/task-manager/workflow`)
- `GET /projects/:id/statuses` - –°—Ç–∞—Ç—É—Å—ã –ø—Ä–æ–µ–∫—Ç–∞
- `POST /statuses` - –°–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç—É—Å
- `PUT /statuses/:id` - –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
- `DELETE /statuses/:id` - –£–¥–∞–ª–∏—Ç—å (–ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∑–∞–¥–∞—á–∏ + is_system)
- `GET /projects/:id/transitions` - –ü–µ—Ä–µ—Ö–æ–¥—ã
- `POST /transitions` - –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–µ—Ö–æ–¥
- `PUT /transitions/:id` - –û–±–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ—Ö–æ–¥
- `DELETE /transitions/:id` - –£–¥–∞–ª–∏—Ç—å –ø–µ—Ä–µ—Ö–æ–¥

**Custom Fields API** (`/api/task-manager/custom-fields`)
- `GET /project/:id` - –ü–æ–ª—è –ø—Ä–æ–µ–∫—Ç–∞
- `POST /` - –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–µ
- `PUT /:id` - –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª–µ
- `DELETE /:id` - –£–¥–∞–ª–∏—Ç—å –ø–æ–ª–µ
- `GET /task/:id/values` - –ó–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∑–∞–¥–∞—á–∏
- `POST /task/:id/values` - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ

**Approvals API** (`/api/task-manager/approvals`)
- `GET /task/:id` - –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
- `POST /task/:id` - –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å (+ –∞–≤—Ç–æ–ø–µ—Ä–µ–≤–æ–¥)
- `DELETE /task/:id` - –û—Ç–æ–∑–≤–∞—Ç—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ

**Comments, Attachments, Tags** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ CRUD

---

## Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü

**TaskManagerPage** - –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–∞–±–ª–∏—Ü–∞/–∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–æ–≤
- –†–æ—É—Ç–∏–Ω–≥ –º–µ–∂–¥—É –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –∏ –∑–∞–¥–∞—á–∞–º–∏

**ProjectsListPage** - –ö–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤
**ProjectsTableView** - –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤ (—Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞–º–∏, health indicator)

**KanbanView** - –ö–∞–Ω–±–∞–Ω –¥–æ—Å–∫–∞
- DndContext –¥–ª—è drag & drop
- –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è status_id
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞, —Ñ–∏–ª—å—Ç—Ä—ã (—Å–∫—Ä—ã—Ç–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö)
- Priority/Status —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö
- Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –æ—à–∏–±–æ–∫

**ListView** - –°–ø–∏—Å–æ—á–Ω—ã–π –≤–∏–¥
- –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
- –¢–µ –∂–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã

**TaskDetailsModal** - –ú–æ–¥–∞–ª–∫–∞ –∑–∞–¥–∞—á–∏
- –î–≤—É—Ö–∫–æ–ª–æ–Ω–æ—á–Ω—ã–π layout (–∫–æ–Ω—Ç–µ–Ω—Ç + —Å–≤–æ–π—Å—Ç–≤–∞)
- 4 –≤–∫–ª–∞–¥–∫–∏: –ü–æ–¥–∑–∞–¥–∞—á–∏, –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –§–∞–π–ª—ã, –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è
- –í—Å–µ –≤–∫–ª–∞–¥–∫–∏ –º–æ–Ω—Ç–∏—Ä—É—é—Ç—Å—è —Å—Ä–∞–∑—É (display:none –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è ‚Üí –Ω–µ—Ç –º–µ—Ä—Ü–∞–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø–æ–ª–µ–π

**ProjectSettingsPage** - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
- 5 –≤–∫–ª–∞–¥–æ–∫: –û–±—â–µ–µ, –£—á–∞—Å—Ç–Ω–∏–∫–∏, –í–æ—Ä–∫—Ñ–ª–æ—É, –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è, –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏

### –ö–ª—é—á–µ–≤—ã–µ hooks

**useTasks(projectId)**
```typescript
- tasks, statuses, loading, error
- fetchTasks() - –∑–∞–≥—Ä—É–∑–∫–∞
- createTask(data) ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç ID
- updateTask(id, updates) - –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –¥–ª—è status_id
- deleteTask(id) - —É–¥–∞–ª—è–µ—Ç + –ø–æ–¥–∑–∞–¥–∞—á–∏
```

**useWorkflow(projectId)**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏
- CRUD —Å—Ç–∞—Ç—É—Å–æ–≤ —Å –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º

**useTransitions(projectId)**
- –ü–µ—Ä–µ—Ö–æ–¥—ã –≤–æ—Ä–∫—Ñ–ª–æ—É
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ—Å—Ç–∏

**useCustomFields(projectId)**
- –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è –ø—Ä–æ–µ–∫—Ç–∞

**useTaskFieldValues(taskId)**
- –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª–µ–π –¥–ª—è –∑–∞–¥–∞—á–∏

**useProjectMembers(projectId)**
- –£—á–∞—Å—Ç–Ω–∏–∫–∏ + –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã

---

## –í–æ—Ä–∫—Ñ–ª–æ—É —Å–∏—Å—Ç–µ–º–∞

### –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞ (tasks_service.py)

**–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ status_id:**

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ `has_workflow_permissions`**
   - –ï—Å–ª–∏ FALSE ‚Üí –ª—é–±–æ–π –º–æ–∂–µ—Ç –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å
   - –ï—Å–ª–∏ TRUE ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Ö–æ–¥

2. **–ü–æ–∏—Å–∫ –ø–µ—Ä–µ—Ö–æ–¥–∞:**
```python
WHERE project_id = ? AND (
    (from_status_id = old AND to_status_id = new) OR
    (from_status_id = new AND to_status_id = old AND is_bidirectional = 1)
)
```

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤:**
   - `permission_type = 'any'` ‚Üí –≤—Å–µ –º–æ–≥—É—Ç
   - `permission_type = 'roles'` ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –≤ allowed_roles (JSON)
   - `permission_type = 'users'` ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ user_id –≤ allowed_users (JSON)

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π:**
   - `requires_attachment` ‚Üí COUNT(task_attachments) > 0
   - `requires_approvals` ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–π (—Å–º. –Ω–∏–∂–µ)

5. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ completed_at:**
   - –ï—Å–ª–∏ –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å `is_final` ‚Üí `completed_at = GETDATE()`
   - –ï—Å–ª–∏ –∏–∑ final –≤ –æ–±—ã—á–Ω—ã–π ‚Üí `completed_at = NULL`

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã

**–ó–∞—â–∏—â–µ–Ω—ã –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è (`is_system = 1`):**
- –ù–æ–≤–∞—è (is_initial)
- –í —Ä–∞–±–æ—Ç–µ
- –ó–∞–≤–µ—Ä—à–µ–Ω–∞ (is_final)
- –û—Ç–º–µ–Ω–µ–Ω–∞ (is_final)

---

## –°–∏—Å—Ç–µ–º–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–π

### –õ–æ–≥–∏–∫–∞ (–¥–ª—è –∫–µ–π—Å–∞ Rework)

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞:**
```
"–ù–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–∏" ‚Üí "–í —Ä–∞–±–æ—Ç–µ"
- –¢—Ä–µ–±—É—é—Ç—Å—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è: 3
- –ö—Ç–æ –º–æ–∂–µ—Ç: [–û–¢–ö, –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ, –ü–ª–∞–Ω–æ–≤—ã–π –æ—Ç–¥–µ–ª]
- –ê–≤—Ç–æ–ø–µ—Ä–µ–≤–æ–¥: ‚úì
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ:**
```python
if requires_approvals and required_approvals_count > 0:
    # –ü–æ–ª—É—á–∞–µ–º —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –æ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    approved_from_pool = [u for u in approved_users if u in required_approvers]
    
    if len(approved_from_pool) < required_approvals_count:
        raise PermissionError("–¢—Ä–µ–±—É–µ—Ç—Å—è N —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–π")
```

**–ê–≤—Ç–æ–ø–µ—Ä–µ–≤–æ–¥ (approvals_service.py ‚Üí check_auto_transition):**

–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ `add_approval`:
1. –ò—â–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥—ã —Å `auto_transition = 1` –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –í–°–ï —É—Å–ª–æ–≤–∏—è (–≤–ª–æ–∂–µ–Ω–∏—è, —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è)
3. –ï—Å–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã ‚Üí UPDATE tasks SET status_id

**–í–∞–∂–Ω–æ:** –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –ü–û–°–õ–ï commit —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è

---

## –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

### –†–æ–ª–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ

**Owner (–≤–ª–∞–¥–µ–ª–µ—Ü):**
- –í—Å–µ –ø—Ä–∞–≤–∞
- –ü–µ—Ä–µ–¥–∞—á–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞
- –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

**Admin (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä):**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–æ—Ä–∫—Ñ–ª–æ—É
- –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø–æ–ª–µ–π
- –°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á
- –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á

**Member (—É—á–∞—Å—Ç–Ω–∏–∫):**
- –°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, —Ñ–∞–π–ª—ã, –ø–æ–¥–∑–∞–¥–∞—á–∏
- –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω –≤ —Å–ø–∏—Å–∫–µ)
- –ù–ï –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –∑–∞–¥–∞—á–∏

**Viewer (–Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—å):**
- –¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä
- –ù–ï –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –≤ –∫–æ–¥–µ

**Backend (–∫–∞–∂–¥—ã–π –º–µ—Ç–æ–¥):**
```python
role = check_project_access(project_id, user_id)
if not role:
    raise PermissionError("–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞")

if role == 'viewer' and action == 'write':
    raise PermissionError("Viewer –Ω–µ –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å")
```

**Frontend:**
- –ö–Ω–æ–ø–∫–∏ —Å–∫—Ä—ã–≤–∞—é—Ç—Å—è/disabled –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏
- userRole –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞

---

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–¢–æ–ª—å–∫–æ –¥–ª—è drag & drop —Å—Ç–∞—Ç—É—Å–∞:**
```typescript
if (updates.status_id !== undefined && Object.keys(updates).length === 1) {
  // –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º UI
  setTasks(prev => prev.map(t => t.id === taskId ? {...t, ...updates} : t));
}
// –ü–æ—Ç–æ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä + fetchTasks —á–µ—Ä–µ–∑ 500–º—Å
```

**–î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π:** —Å–Ω–∞—á–∞–ª–∞ —Å–µ—Ä–≤–µ—Ä, –ø–æ—Ç–æ–º UI

### –í–æ—Ä–∫—Ñ–ª–æ—É - –ø–æ—Ä—è–¥–æ–∫ —Å—Ç–∞—Ç—É—Å–æ–≤

**–û–±–º–µ–Ω –º–µ—Å—Ç–∞–º–∏ (swap):**
```typescript
await updateStatus(status1.id, { order_index: status2.order_index });
await updateStatus(status2.id, { order_index: status1.order_index });
// –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –±–µ–∑ await ‚Üí –±—ã—Å—Ç—Ä–µ–µ
```

### –§–∞–π–ª—ã

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è:**
```
uploads/task_attachments/
  ‚îú‚îÄ‚îÄ –ù–∞–∑–≤–∞–Ω–∏–µ_–ø—Ä–æ–µ–∫—Ç–∞/
  ‚îÇ   ‚îî‚îÄ‚îÄ uuid.—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
```

**–õ–æ–≥–∏–∫–∞:**
- –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–º—è (—Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π) ‚Üí –≤ –ë–î
- UUID –∏–º—è ‚Üí –Ω–∞ –¥–∏—Å–∫–µ
- –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ: –∏–º—è –ø—Ä–æ–µ–∫—Ç–∞ –æ—á–∏—â–∞–µ—Ç—Å—è –æ—Ç –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ Windows

---

## –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è

### –¢–∏–ø—ã –ø–æ–ª–µ–π

1. **text** - –æ–±—ã—á–Ω—ã–π input
2. **number** - number input
3. **date** - date picker
4. **select** - dropdown (field_options = JSON –º–∞—Å—Å–∏–≤)
5. **checkbox** - boolean (–∑–Ω–∞—á–µ–Ω–∏–µ "true"/"false")

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ

**–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏:**
- createTask –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç ID
- –¶–∏–∫–ª –ø–æ customFieldValues
- POST –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è

**–ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏:**
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ
- –ü—Ä–∏ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" ‚Üí POST –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—è
- –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ

---

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ú–æ–¥–∞–ª–∫–∏ - —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫ –º–æ–¥–∞–ª–∫–∞ –º–µ–Ω—è–ª–∞ —Ä–∞–∑–º–µ—Ä

**–†–µ—à–µ–Ω–∏–µ:**
```tsx
<div className="h-[85vh]">  // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞
  <div className="flex h-full overflow-hidden">
    <div className="flex-1 overflow-y-auto">  // –°–∫—Ä–æ–ª–ª –∫–æ–Ω—Ç–µ–Ω—Ç–∞
```

### –°—á–µ—Ç—á–∏–∫–∏ –±–µ–∑ –º–µ—Ä—Ü–∞–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏ —Å—á–µ—Ç—á–∏–∫: 0 ‚Üí 2 ‚Üí –º–µ—Ä—Ü–∞–Ω–∏–µ

**–†–µ—à–µ–Ω–∏–µ:**
```tsx
// –í—Å–µ –≤–∫–ª–∞–¥–∫–∏ –º–æ–Ω—Ç–∏—Ä—É—é—Ç—Å—è —Å—Ä–∞–∑—É
<div style={{ display: activeTab === 'comments' ? 'block' : 'none' }}>
  <CommentsSection onCountChange={setCommentCount} />
</div>

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
useEffect(() => {
  if (onCountChange && !loading) {
    onCountChange(comments.length);
  }
}, [comments.length, loading]);
```

### –ê–≤–∞—Ç–∞—Ä—ã —Å fallback

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç Avatar:**
```tsx
const [imageError, setImageError] = useState(false);

if (imageUrl && !imageError) {
  return <img onError={() => setImageError(true)} />
}
// –ò–Ω–∞—á–µ –∏–Ω–∏—Ü–∏–∞–ª—ã —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º
```

### Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤–æ—Ä–∫—Ñ–ª–æ—É:**
- updateTask –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç Error
- handleDragEnd catch ‚Üí showToast(error.message, 'error')
- Toast –∞–≤—Ç–æ–∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ 4 —Å–µ–∫

---

## –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ
1. **Zustand/Redux** - –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (—Å–µ–π—á–∞—Å prop drilling)
2. **React Query** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ API –∑–∞–ø—Ä–æ—Å–æ–≤
3. **Websockets** - —Ä–µ–∞–ª-—Ç–∞–π–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
1. **–í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è** —Å–ø–∏—Å–∫–æ–≤ (react-window) –ø—Ä–∏ 1000+ –∑–∞–¥–∞—á
2. **Debounce** –¥–ª—è –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø–æ–ª–µ–π
3. **Batch API** - –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
1. **Rate limiting** –Ω–∞ Backend
2. **CSRF —Ç–æ–∫–µ–Ω—ã**
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è** —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤ (—Å–µ–π—á–∞—Å –Ω–µ—Ç –ª–∏–º–∏—Ç–∞)

---

## –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### Backend
```bash
cd Back
python Run_Server.py
# –°–µ—Ä–≤–µ—Ä –Ω–∞ http://localhost:5000
```

### Frontend
```bash
cd Front/big-statistics-dashboard
npm run dev
# –°–µ—Ä–≤–µ—Ä –Ω–∞ http://localhost:3000
```

### SQL —Å–∫—Ä–∏–ø—Ç—ã (–≤ –ø–æ—Ä—è–¥–∫–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)
1. `create_tables.sql` - –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
2. `custom_fields.sql` - –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è
3. `add_completed_at.sql` - –î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
4. `add_default_assignees.sql` - –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
5. `add_system_statuses.sql` - –ó–∞—â–∏—Ç–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤
6. `update_transitions_schema.sql` - permission_type, allowed_users
7. `add_bidirectional.sql` - –î–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã
8. `add_transition_conditions.sql` - –£—Å–ª–æ–≤–∏—è (–≤–ª–æ–∂–µ–Ω–∏—è, —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è)
9. `create_approvals.sql` - –¢–∞–±–ª–∏—Ü–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–π
10. `add_auto_transition.sql` - –§–ª–∞–≥ –∞–≤—Ç–æ–ø–µ—Ä–µ–≤–æ–¥–∞

---

## Troubleshooting

### "–ó–∞–¥–∞—á–∞ –Ω–µ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è"
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `has_workflow_permissions` –≤ –ø—Ä–æ–µ–∫—Ç–µ
- –í–∫–ª—é—á–∏—Ç—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö "–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥—ã"
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Backend

### "–ê–≤—Ç–æ–ø–µ—Ä–µ–≤–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `auto_transition = 1` –≤ –ø–µ—Ä–µ—Ö–æ–¥–µ
- –õ–æ–≥–∏: `[AUTO]` –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ Python
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —É—Å–ª–æ–≤–∏–π

### "–ú–µ—Ä—Ü–∞–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤"
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤–∫–ª–∞–¥–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `display: none` –∞ –Ω–µ —É—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä

---

–ê–≤—Ç–æ—Ä: AI Assistant  
–î–∞—Ç–∞: 23.10.2025  
–í–µ—Ä—Å–∏—è: 1.0

